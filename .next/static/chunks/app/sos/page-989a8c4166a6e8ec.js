(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[530],{283:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,O:()=>c});var a=r(5155),s=r(2115),o=r(6671);let n=(0,s.createContext)(void 0),c=e=>{let{children:t}=e,[r,c]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("user");if(e&&"undefined"!==e&&"null"!==e){let t=JSON.parse(e);c(t)}}catch(e){console.error("Error parsing stored user:",e),localStorage.removeItem("user")}finally{l(!1)}},[]);let d=async(e,t,r,a,s)=>{l(!0);try{let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,phoneNumber:r,password:a})}),i=await n.json();if(!n.ok)return void o.oR.error(i.error||"Registration failed. Please try again.");c(i.user),localStorage.setItem("user",JSON.stringify(i.user)),o.oR.success("Registration successful!"),s&&s()}catch(e){console.error("Registration error:",e),o.oR.error("Unable to connect to server. Please try again.")}finally{l(!1)}},u=async(e,t,r)=>{l(!0);try{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),s=await a.json();if(!a.ok)return void o.oR.error(s.error||"Login failed. Please check your credentials.");c(s.user),localStorage.setItem("user",JSON.stringify(s.user)),o.oR.success("Welcome back, ".concat(s.user.name,"!")),r&&r()}catch(e){console.error("Login error:",e),o.oR.error("Unable to connect to server. Please try again.")}finally{l(!1)}},m=async e=>{if(r)try{let t=await fetch("/api/emergency-contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.id,...e})}),a=await t.json();if(!t.ok)return void o.oR.error(a.error||"Failed to add contact");let s=[...r.emergencyContacts||[],a.contact],n={...r,emergencyContacts:s};c(n),localStorage.setItem("user",JSON.stringify(n)),o.oR.success("Emergency contact added successfully")}catch(e){o.oR.error("Failed to add contact")}},f=async e=>{if(r)try{let t=await fetch("/api/emergency-contact",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.id,contactId:e})}),a=await t.json();if(!t.ok)return void o.oR.error(a.error||"Failed to remove contact");let s=(r.emergencyContacts||[]).filter(t=>t.id!==e),n={...r,emergencyContacts:s};c(n),localStorage.setItem("user",JSON.stringify(n)),o.oR.success("Emergency contact removed")}catch(e){o.oR.error("Failed to remove contact")}},g=async e=>{l(!0);try{await new Promise(e=>setTimeout(e,1e3)),o.oR.success("Password reset link sent to your email")}catch(e){throw o.oR.error(e instanceof Error?e.message:"Password reset failed"),e}finally{l(!1)}};return(0,a.jsx)(n.Provider,{value:{user:r,isLoading:i,isAuthenticated:!!r,register:d,login:u,logout:()=>{c(null),localStorage.removeItem("user"),o.oR.success("You have been logged out")},addEmergencyContact:m,removeEmergencyContact:f,resetPassword:g},children:t})},i=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},285:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var a=r(5155),s=r(2115),o=r(9708),n=r(2085),c=r(9434);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:l=!1,...d}=e,u=l?o.DX:"button";return(0,a.jsx)(u,{className:(0,c.cn)(i({variant:s,size:n,className:r})),ref:t,...d})});l.displayName="Button"},5339:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6389:(e,t,r)=>{Promise.resolve().then(r.bind(r,9207))},6695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>i,Zp:()=>n,aR:()=>c,wL:()=>u});var a=r(5155),s=r(2115),o=r(9434);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...s})});c.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});i.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...s})});l.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},6948:(e,t,r)=>{"use strict";r.d(t,{Lu:()=>s,Wc:()=>n,j$:()=>o});var a=r(6671);let s=()=>new Promise((e,t)=>{if(!navigator.geolocation){a.oR.error("Geolocation is not supported by your browser"),t(Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},e=>{let r="Unknown error occurred";switch(e.code){case e.PERMISSION_DENIED:r="Location permission denied";break;case e.POSITION_UNAVAILABLE:r="Location information is unavailable";break;case e.TIMEOUT:r="Request to get location timed out"}a.oR.error(r),t(Error(r))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),o=e=>"https://www.google.com/maps?q=".concat(e.latitude,",").concat(e.longitude);async function n(e,t,r,a,s){let o=await fetch("/api/sos/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contacts:e,message:t,locationUrl:r,senderName:a,senderEmail:s})}),n=await o.json();if(!o.ok)throw Error(n.error||"Failed to send SOS alert");return n}},9207:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(5155),s=r(2115),o=r(285),n=r(283),c=r(6948),i=r(6671),l=r(9946);let d=(0,l.A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var u=r(5339);let m=(0,l.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),f=(0,l.A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var g=r(6695),y=r(9434);let h=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,y.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...s})});h.displayName="Textarea";var p=r(5695);let x=()=>{let{user:e}=(0,n.A)(),t=(0,p.useRouter)(),[r,l]=(0,s.useState)(!1),[y,x]=(0,s.useState)(!1),[v,b]=(0,s.useState)(""),w=async()=>{if(!e||!e.emergencyContacts||0===e.emergencyContacts.length){i.oR.error("Please add emergency contacts first"),t.push("/profile");return}x(!0);try{let t=await (0,c.Lu)(),r=(0,c.j$)(t),a=(await (0,c.Wc)(e.emergencyContacts,v?"".concat(v," - Current location:"):"SOS ALERT: I need immediate assistance! This is my current location:",r,e.name,e.email)).results.filter(e=>"sent"!==e.status);0===a.length?(l(!0),i.oR.success("SOS alert sent successfully to all emergency contacts")):(l(!0),i.oR.warning("SOS sent, but some emails failed: ".concat(a.map(e=>e.email).join(", "))))}catch(e){i.oR.error("Failed to send SOS alert. Please try again.")}finally{x(!1)}};return(0,a.jsxs)("div",{className:"container max-w-md mx-auto py-12 px-4",children:[(0,a.jsxs)(o.$,{variant:"ghost",className:"mb-6",onClick:()=>t.back(),children:[(0,a.jsx)(d,{className:"h-4 w-4 mr-1"}),"Back"]}),(0,a.jsxs)(g.Zp,{className:r?"border-red-500 shadow-lg":"",children:[(0,a.jsxs)(g.aR,{className:"text-center",children:[(0,a.jsx)(g.ZB,{className:"text-2xl",children:"Emergency SOS"}),(0,a.jsx)(g.BT,{children:"Send an emergency alert with your location to your trusted contacts"})]}),(0,a.jsx)(g.Wu,{className:"space-y-6",children:r?(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsxs)("div",{className:"bg-red-100 text-red-700 p-4 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center mb-2",children:[(0,a.jsx)(u.A,{className:"h-6 w-6 mr-2 animate-pulse"}),(0,a.jsx)("span",{className:"font-semibold",children:"SOS ACTIVATED"})]}),(0,a.jsx)("p",{className:"text-sm",children:"Your emergency contacts have been notified with your location. Stay safe and try to remain where you are if possible."})]}),e&&e.emergencyContacts&&(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(m,{className:"h-5 w-5 mr-2 text-gray-500"}),(0,a.jsx)("span",{className:"font-medium",children:"Notified contacts:"})]}),(0,a.jsx)("ul",{className:"space-y-1 ml-7 text-sm",children:e.emergencyContacts.map(e=>(0,a.jsxs)("li",{children:[(0,a.jsx)(f,{className:"h-4 w-4 inline-block mr-1 text-green-500"}),e.name," (",e.relationship,")"]},e.id))})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-gray-600",children:"This will send an alert with your current location to all your emergency contacts. You can add a custom message below."}),(0,a.jsx)(h,{placeholder:"Add additional details about your emergency (optional)",value:v,onChange:e=>b(e.target.value),className:"resize-none",maxLength:200}),(!e||!e.emergencyContacts||0===e.emergencyContacts.length)&&(0,a.jsx)("div",{className:"bg-yellow-50 text-yellow-700 p-3 rounded-md text-sm",children:"You need to add emergency contacts before using this feature."})]})}),(0,a.jsx)(g.wL,{className:"flex justify-center pt-2",children:r?(0,a.jsx)(o.$,{onClick:()=>{l(!1),b(""),i.oR.success("SOS deactivated")},variant:"outline",className:"w-full",children:"Deactivate SOS"}):(0,a.jsx)(o.$,{onClick:w,disabled:y||!e||!e.emergencyContacts||0===e.emergencyContacts.length,className:"bg-safety-red hover:bg-red-600 w-full",children:y?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Sending Alert..."]}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Activate SOS Alert"]})})})]})]})}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var a=r(2596),s=r(9688);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(2115);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:l="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:r,strokeWidth:i?24*Number(c)/Number(s):c,className:o("lucide",l),...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:i,...l}=r;return(0,a.createElement)(c,{ref:n,iconNode:t,className:o("lucide-".concat(s(e)),i),...l})});return r.displayName="".concat(e),r}}},e=>{var t=t=>e(e.s=t);e.O(0,[352,753,441,684,358],()=>t(6389)),_N_E=e.O()}]);